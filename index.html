<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <!-- Mobil cihazlarda düzgün miqyas üçün metatag -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kenoo</title>
  <!-- Google Fonts: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* ===== Ümumi Tərtibat ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    h1 {
      margin-bottom: 20px;
      color: #333;
      font-weight: 600;
      font-size: 2rem;
      text-align: center;
    }
    #container {
      width: 100%;
      max-width: 600px;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      padding: 30px 20px; /* Default padding */
      text-align: center;
      transition: transform 0.3s ease;
      position: relative;
    }
    #container:hover {
      transform: translateY(-2px);
    }
    .section-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #555;
      margin-bottom: 16px;
    }

    /* ===== “Geri” Düyməsi ===== */
    .back-btn {
      position: absolute;
      top: 16px;
      left: 16px;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      background-color: #9e9e9e;
      color: #fff;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: background 0.3s ease;
    }
    .back-btn:hover {
      background-color: #757575;
    }

    /* ===== “Has Back” (mövzu seçimində) üçün əlavə padding ===== */
    #container.has-back {
      /* “Geri” düyməsi üstündə olduğu üçün 50px yuxarıda yerləşəcək boşluq */
      padding-top: 50px;
    }

    /* ===== Başlanğıc Düymələri ===== */
    .start-btn {
      padding: 14px 28px;
      margin: 8px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
      color: #fff;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4);
    }
    .start-btn:hover {
      background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
      box-shadow: 0 6px 16px rgba(66, 165, 245, 0.5);
    }

    /* ===== Quiz Seçim Düymələri ===== */
    #btn-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
    }
    .quiz-btn {
      flex: 1 1 120px;
      max-width: 160px;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #ffb74d 0%, #ffa726 100%);
      color: #fff;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 183, 77, 0.4);
      text-align: center;
    }
    .quiz-btn:hover {
      background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(255, 183, 77, 0.5);
    }

    /* ===== Iframe tərtibatı ===== */
    iframe {
      width: 100%;
      height: 60vh; /* Kiçik ekran üçün 60vh; media query-də daha da kiçildilir */
      border: none;
      border-radius: 12px;
      margin-top: 24px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    /* ===== Xəta Mesajı ===== */
    #error-message {
      color: #d32f2f;
      font-weight: 600;
      font-size: 1rem;
      margin-top: 20px;
    }

    /* ===== Mobil optimallaşdırma ===== */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      h1 {
        font-size: 1.5rem;
        margin-bottom: 16px;
      }
      #container {
        padding: 20px 12px;
      }
      #container.has-back {
        /* Mobil üçün “Geri” üst boşluğunu azca kiçiltmək mümkündür (əgər lazım olsa) */
        padding-top: 45px;
      }
      .start-btn, .quiz-btn {
        width: 100%;
        max-width: unset;
        font-size: 1rem;
        padding: 12px 0;
      }
      #btn-container {
        gap: 8px;
      }
      iframe {
        height: 50vh; /* Kiçik mobil cihazlarda səhifədə çox boşluq qalmasın deyə 50vh */
      }
    }
  </style>
</head>
<body>
  <h1>Quiz Mövzularını Seçin</h1>
  <div id="container">
    <!-- Əsas menyu şablonu (geri düyməsi olmadan) -->
    <p class="section-title">Başlanğıc mövzusu:</p>
    <button class="start-btn" onclick="startQuiz('proqramlasdirma')">Proqramlaşdırma</button>
    <button class="start-btn" onclick="startQuiz('xetti')">Xətti Cəbr</button>
    <button class="start-btn" onclick="startQuiz('xdiak')">XDIAK</button>
    <button class="start-btn" onclick="startQuiz('diferensial')">Diferensial</button>
    <p id="error-message" style="display: none;">Reddol burdan.</p>
  </div>

  <script>
    const allowedIPPrefixes = [
      "37.114.",
      "45.15.",
      "37.61.",
      "82.194.",
      "185.146.",
      "94.20.",
      "149.126."
    ];
    let userAllowed = false;
    const container = document.getElementById("container");

    // Əsas menyunu yenidən göstərən şablon
    const mainMenuHTML = `
      <p class="section-title">Başlanğıc mövzusu:</p>
      <button class="start-btn" onclick="startQuiz('proqramlasdirma')">Proqramlaşdırma</button>
      <button class="start-btn" onclick="startQuiz('xetti')">Xətti Cəbr</button>
      <button class="start-btn" onclick="startQuiz('xdiak')">XDIAK</button>
      <button class="start-btn" onclick="startQuiz('diferensial')">Diferensial</button>
      <p id="error-message" style="display: none;">Reddol burdan.</p>
    `;

    // iOS yoxlaması üçün dəyişən
    const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

    // IP yoxlaması: əgər icazəli prefix-lərdən biriylə başlayırsa davam et, yoxdursa mesaj göstər
    async function checkIP() {
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        const userIP = data.ip;
        userAllowed = allowedIPPrefixes.some(prefix => userIP.startsWith(prefix));
        if (!userAllowed) {
          container.style.display = "none";
          document.getElementById("error-message").style.display = "block";
        }
      } catch (err) {
        console.error("Xəta baş verdi:", err);
      }
    }

    // Əsas menyuya qayıtmaq üçün funksiya
    function showMainMenu() {
      // “Has-back” sinifini sil, yəni artıq geri düyməsi əlavə deyil
      container.classList.remove('has-back');
      container.innerHTML = mainMenuHTML;
    }

    // Mövzu seçimi ekranını göstərən funksiya
    function startQuiz(topic) {
      if (!userAllowed) return;

      let titleText = '';
      let links = [];
      let labels = [];

      switch (topic) {
        case 'proqramlasdirma':
          titleText = 'Proqramlaşdırma suallarını seç:';
          links = [
            "https://quizizz.com/embed/quiz/683dddfd79bab9c70d96170f",
            "https://quizizz.com/embed/quiz/683dde151f8214ac74f7703d",
            "https://quizizz.com/embed/quiz/683dde314708a5aad48cb67f"
          ];
          labels = ["1-110", "111-220", "221-350"];
          break;
        case 'xetti':
          titleText = 'Xətti Cəbr suallarını seç:';
          links = [
            "https://quizizz.com/embed/quiz/683f58989ba449e01c456667",
            "https://quizizz.com/embed/quiz/683f58af9413297320bc29f1",
            "https://quizizz.com/embed/quiz/683f58c21258dca9091f1082"
          ];
          labels = ["1-111", "112-218", "219-320"];
          break;
        case 'xdiak':
          titleText = 'XDIAK suallarını seç:';
          links = [
            "https://quizizz.com/embed/quiz/683f5cf4c777386684e14481",
            "https://quizizz.com/embed/quiz/683f5d1279bab9c70d96c2b5",
            "https://quizizz.com/embed/quiz/683f5d2eeee6434cec6396e2",
            "https://quizizz.com/embed/quiz/683f5d50eee6434cec6396e7"
          ];
          labels = ["1-100", "101-200", "201-300", "301-425"];
          break;
        case 'diferensial':
          titleText = 'Diferensial suallarını seç:';
          links = [
            "https://quizizz.com/embed/quiz/683f60a44708a5aad48d66d1",
            "https://quizizz.com/embed/quiz/683f60b29413297320bc2baf",
            "https://quizizz.com/embed/quiz/683f60d33740abec43503e14"
          ];
          labels = ["1-100", "101-205", "206-301"];
          break;
        default:
          titleText = 'Bölmə tapılmadı';
      }

      // “Has-back” sinifini əlavə et ki, containerə yuxarıdan boşluq verilsin
      container.classList.add('has-back');

      // Container-in içini tamamilə dəyişərək “Geri” düyməsi + başlığı yerləşdiririk
      container.innerHTML = `
        <button class="back-btn" onclick="showMainMenu()">‹ Geri</button>
        <p class="section-title">${titleText}</p>
      `;

      // Seçim düymələri üçün konteyneri yaradıb əlavə edək
      const btnContainer = document.createElement("div");
      btnContainer.id = "btn-container";

      // Hər bir linkə uyğun düymə əlavə edirik
      links.forEach((link, index) => {
        const btn = document.createElement("button");
        btn.className = "quiz-btn";
        btn.textContent = labels[index];
        btn.onclick = () => openQuiz(link);
        btnContainer.appendChild(btn);
      });
      container.appendChild(btnContainer);
    }

    // Quiz-i iframe-də açan funksiya
    function openQuiz(link) {
      // Əgər əvvəldən açılmış iframe varsa, sil:
      const existingIframe = document.getElementById("fullscreen-quiz");
      if (existingIframe) existingIframe.remove();

      // Yeni iframe yaradıb bədənə əlavə et
      const iframe = document.createElement("iframe");
      iframe.src = link;
      iframe.id = "fullscreen-quiz";
      iframe.allow = "fullscreen";               // Müxtəlif brauzerlər üçün icazə
      iframe.allowFullscreen = true;              // Standart atribut
      iframe.setAttribute("webkitallowfullscreen", "");  // WebKit (iOS/Safari)
      iframe.setAttribute("mozallowfullscreen", "");     // Firefox

      document.body.appendChild(iframe);

      // iOS-dursa tam ekran etmə, çünki iOS-da bu kod bloklana bilər
      if (!isiOS) {
        // Tam ekran rejiminə keçid
        if (iframe.requestFullscreen) iframe.requestFullscreen();
        else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
        else if (iframe.msRequestFullscreen) iframe.msRequestFullscreen();
      }

      // Tam ekrandan çıxdığı an iframe-i sil
      document.addEventListener("fullscreenchange", handleExit);
      document.addEventListener("webkitfullscreenchange", handleExit);
      document.addEventListener("msfullscreenchange", handleExit);
    }

    // Tam ekrandan çıxış baş verəndə iframe-i oradan sil və event listener-ları təmizlə
    function handleExit() {
      const iframe = document.getElementById("fullscreen-quiz");
      if (!document.fullscreenElement && iframe) {
        iframe.remove();
        document.removeEventListener("fullscreenchange", handleExit);
        document.removeEventListener("webkitfullscreenchange", handleExit);
        document.removeEventListener("msfullscreenchange", handleExit);
      }
    }

    // Səhifə yüklənincə IP yoxlaması icra et
    window.onload = checkIP;
  </script>
</body>
</html>
